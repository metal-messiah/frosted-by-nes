"use strict";(self.webpackChunkfrosted_by_nes=self.webpackChunkfrosted_by_nes||[]).push([[661],{7661:(t,e,s)=>{s.d(e,{o:()=>h});var i=s(3197),r=s(3114),n=s(2041),o=s(8464),a=s(9471);class h extends r.w{constructor(t,e,s){var i;super(s),this.endpoint=t,this.opts=e||{},this.started=!1,this.timeoutHandle=null,this.aborted=!1,this.harvest=new n.M(this.sharedContext),(0,o.L)(this.unload.bind(this)),null===(i=this.sharedContext)||void 0===i||i.ee.on(a.wO.RESET,(()=>this.runHarvest({forceNoRetry:!0})))}unload(){this.aborted||(this.opts.onUnload&&this.opts.onUnload(),this.runHarvest({unload:!0}))}startTimer(t,e){this.interval=t,this.started=!0,this.scheduleHarvest(null!=e?e:this.interval)}stopTimer(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.aborted=t,this.started=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}scheduleHarvest(t,e){this.timeoutHandle||(null==t&&(t=this.interval),this.timeoutHandle=setTimeout((()=>{this.timeoutHandle=null,this.runHarvest(e)}),1e3*t))}runHarvest(t){if(this.aborted)return;const e=e=>{null!==t&&void 0!==t&&t.forceNoRetry&&(e.retry=!1),this.onHarvestFinished(t,e)};let s,r,n=[];if(this.opts.getPayload){if(s=i.qD({isFinalHarvest:null===t||void 0===t?void 0:t.unload}),!s)return!1;const e=!(null!==t&&void 0!==t&&t.unload)&&s===i.Be;if(r=this.opts.getPayload({retry:e}),!r)return void(this.started&&this.scheduleHarvest());r="[object Array]"===Object.prototype.toString.call(r)?r:[r],n.push(...r)}let o=t=>this.harvest.sendX(t);n.length?o=this.opts.raw?t=>this.harvest._send(t):t=>this.harvest.send(t):n.push(void 0),n.forEach((i=>{o({endpoint:this.endpoint,payload:i,opts:t,submitMethod:s,cbFinished:e,customUrl:this.opts.customUrl,raw:this.opts.raw})})),this.started&&this.scheduleHarvest()}onHarvestFinished(t,e){if(this.opts.onFinished&&this.opts.onFinished(e),e.sent&&e.retry){const s=e.delay||this.opts.retryDelay;this.started&&s?(clearTimeout(this.timeoutHandle),this.timeoutHandle=null,this.scheduleHarvest(s,t)):!this.started&&s&&this.scheduleHarvest(s,t)}}}},9471:(t,e,s)=>{s.d(e,{IK:()=>w,wO:()=>E,uT:()=>T,$s:()=>M});var i=s(662),r=s(1760),n=s(8038),o=s(4836);class a{constructor(t,e){if(!t.onEnd)throw new Error("onEnd handler is required");if(!e)throw new Error("ms duration is required");this.onEnd=t.onEnd,this.initialMs=e,this.startTimestamp=Date.now(),this.timer=this.create(this.onEnd,e)}create(t,e){return this.timer&&this.clear(),setTimeout((()=>t?t():this.onEnd()),e||this.initialMs)}clear(){clearTimeout(this.timer),this.timer=null}end(){this.clear(),this.onEnd()}isValid(){return this.initialMs-(Date.now()-this.startTimestamp)>0}}var h=s(3980),l=s(2162),u=s(536),d=s(1043);class c extends a{constructor(t,e){super(t,e),this.onPause="function"===typeof t.onPause?t.onPause:()=>{},this.onRefresh="function"===typeof t.onRefresh?t.onRefresh:()=>{},this.onResume="function"===typeof t.onResume?t.onResume:()=>{},this.remainingMs=void 0,t.refreshEvents||(t.refreshEvents=["click","keydown","scroll"]);try{this.abortController=new AbortController}catch(i){}if(h.il&&t.ee){var s;if(t.ee){this.ee=t.ee;const e=(0,d.D)(this.refresh.bind(this),500,{leading:!0});this.refreshHandler=s=>{var i;t.refreshEvents.includes(null===s||void 0===s||null===(i=s[0])||void 0===i?void 0:i.type)&&e()},t.ee.on("fn-end",this.refreshHandler)}(0,u.N)((t=>{"hidden"===t?this.pause():this.resume()}),!1,!1,null===(s=this.abortController)||void 0===s?void 0:s.signal)}}abort(){var t;this.clear(),null===(t=this.abortController)||void 0===t||t.abort(),this.refreshHandler&&(this.ee.removeEventListener("fn-end",this.refreshHandler),this.refreshHandler=this.ee=null)}pause(){this.onPause(),clearTimeout(this.timer),this.remainingMs=this.initialMs-(Date.now()-this.startTimestamp)}resume(){this.refresh(),this.onResume()}refresh(t,e){this.clear(),this.timer=this.create(t,e),this.startTimestamp=Date.now(),this.remainingMs=void 0,this.onRefresh()}}var v=s(5950),p=s(8673),m=s(5894),f=s(6477),y=s(9025),g=s(1997);const w={OFF:0,FULL:1,ERROR:2},A={value:"",inactiveAt:0,expiresAt:0,updatedAt:Date.now(),sessionReplayMode:w.OFF,sessionReplaySentFirstChunk:!1,sessionTraceMode:w.OFF,traceHarvestStarted:!1,custom:{}},E={PAUSE:"session-pause",RESET:"session-reset",RESUME:"session-resume",UPDATE:"session-update"},T={SAME_TAB:"same-tab",CROSS_TAB:"cross-tab"};class M{constructor(t){const{agentIdentifier:e,key:s,storage:i}=t;if(!e||!s||!i)throw new Error("Missing required field(s):".concat(e?"":" agentID").concat(s?"":" key").concat(i?"":" storage"));this.agentIdentifier=e,this.storage=i,this.state={},this.key=s,this.ee=o.ee.get(e),(0,v.em)(this.ee),this.setup(t),h.il&&(0,g.bP)("storage",(t=>{if(t.key===this.lookupKey){const e="string"===typeof t.newValue?JSON.parse(t.newValue):t.newValue;this.sync(e),this.ee.emit(E.UPDATE,[T.CROSS_TAB,this.state])}}))}setup(t){let{value:e=(0,i.ky)(16),expiresMs:s=l.oD,inactiveMs:r=l.Hb}=t;this.state={},this.sync(A),this.state.value=e,this.expiresMs=s,this.inactiveMs=r;const n=this.read();s?(this.state.expiresAt=(null===n||void 0===n?void 0:n.expiresAt)||this.getFutureTimestamp(s),this.expiresTimer=new a({onEnd:()=>{this.collectSM("expired"),this.collectSM("duration"),this.reset()}},this.state.expiresAt-Date.now())):this.state.expiresAt=1/0,r?(this.state.inactiveAt=(null===n||void 0===n?void 0:n.inactiveAt)||this.getFutureTimestamp(r),this.inactiveTimer=new c({onEnd:()=>{this.collectSM("inactive"),this.collectSM("duration"),this.reset()},onRefresh:this.refresh.bind(this),onResume:()=>{this.ee.emit(E.RESUME)},onPause:()=>{this.initialized&&this.ee.emit(E.PAUSE),this.write((0,p.D)(this.state,A))},ee:this.ee,refreshEvents:["click","keydown","scroll"]},this.state.inactiveAt-Date.now())):this.state.inactiveAt=1/0,this.isNew=!Object.keys(n).length,this.isNew?this.write((0,p.D)(this.state,A),!0):this.sync(n),this.initialized=!0}get lookupKey(){return"".concat(l.Bq,"_").concat(this.key)}sync(t){Object.assign(this.state,t)}read(){try{const t=this.storage.get(this.lookupKey);if(!t)return{};const e="string"===typeof t?JSON.parse(t):t;return this.isInvalid(e)?{}:this.isExpired(e.expiresAt)?(this.collectSM("expired"),this.collectSM("duration",e,!0),this.reset()):this.isExpired(e.inactiveAt)?(this.collectSM("inactive"),this.collectSM("duration",e,!0),this.reset()):e}catch(t){return(0,r.Z)("Failed to read from storage API",t),{}}}write(t){try{if(!t||"object"!==typeof t)return;return t.updatedAt=Date.now(),this.sync(t),this.storage.set(this.lookupKey,(0,n.P)(this.state)),this.ee.emit(E.UPDATE,[T.SAME_TAB,this.state]),t}catch(e){return(0,r.Z)("Failed to write to the storage API",e),null}}reset(){try{var t,e,s,i;return this.initialized&&this.ee.emit(E.RESET),this.storage.remove(this.lookupKey),null===(t=this.inactiveTimer)||void 0===t||null===(e=t.abort)||void 0===e||e.call(t),null===(s=this.expiresTimer)||void 0===s||null===(i=s.clear)||void 0===i||i.call(s),delete this.isNew,this.setup({agentIdentifier:this.agentIdentifier,key:this.key,storage:this.storage,expiresMs:this.expiresMs,inactiveMs:this.inactiveMs}),this.read()}catch(r){return{}}}refresh(){const t=this.read();this.write({...t,inactiveAt:this.getFutureTimestamp(this.inactiveMs)})}isExpired(t){return Date.now()>t}isInvalid(t){return!Object.keys(A).every((e=>Object.keys(t).includes(e)))}collectSM(t,e,s){let i,r;"duration"===t&&(i=this.getDuration(e,s),r="Session/Duration/Ms"),"expired"===t&&(r="Session/Expired/Seen"),"inactive"===t&&(r="Session/Inactive/Seen"),r&&(0,m.p)(f.xS,[r,i],void 0,y.D.metrics,this.ee)}getDuration(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,e=arguments.length>1?arguments[1]:void 0;const s=t.expiresAt-this.expiresMs;return(e?Date.now():t.updatedAt)-s}getFutureTimestamp(t){return Date.now()+t}syncCustomAttribute(t,e){if(h.il)if(null===e){const e=this.read();e.custom&&(delete e.custom[t],this.write({...e}))}else{const s=this.read();this.custom={...(null===s||void 0===s?void 0:s.custom)||{},[t]:e},this.write({...s,custom:this.custom})}}}},8464:(t,e,s)=>{s.d(e,{L:()=>o});var i=s(1997),r=s(3980),n=s(536);if(r.v6){r._A.cleanupTasks=[];const t=r._A.close;r._A.close=()=>{for(let t of r._A.cleanupTasks)t();t()}}function o(t){r.il?((0,n.N)(t,!0),(0,i.bP)("pagehide",t)):r.v6&&r._A.cleanupTasks.push(t)}},1043:(t,e,s)=>{function i(t){var e=this;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(null===i||void 0===i?void 0:i.leading)||!1;let n;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];r&&void 0===n&&(t.apply(e,o),n=setTimeout((()=>{n=clearTimeout(n)}),s)),r||(clearTimeout(n),n=setTimeout((()=>{t.apply(e,o)}),s))}}function r(t){var e=this;let s=!1;return function(){if(!s){s=!0;for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];t.apply(e,r)}}}s.d(e,{D:()=>i,Z:()=>r})}}]);
//# sourceMappingURL=661.f8eb0a73.chunk.js.map