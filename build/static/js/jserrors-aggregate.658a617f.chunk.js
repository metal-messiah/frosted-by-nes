"use strict";(self.webpackChunkfrosted_by_nes=self.webpackChunkfrosted_by_nes||[]).push([[317],{1645:(e,r,t)=>{t.r(r),t.d(r,{Aggregate:()=>R});var n=t(4572);const s=/([a-z0-9]+)$/i;function a(e){if(!e)return;const r=e.match(s);return r?r[1]:void 0}var i=/^\n+|\n+$/g;function o(e){return function(e){var r;if(e.length>100){var t=e.length-100;r=e.slice(0,50).join("\n"),r+="\n< ...truncated "+t+" lines... >\n",r+=e.slice(-50).join("\n")}else r=e.join("\n");return r}(e).replace(i,"")}var c=t(3980),u=t(8575);function h(e){if("string"!==typeof e)return"";const r=(0,u.f)(e);return r===(0,u.f)(c.FN)?"<inline>":r}var d=!1,l=/function (.+?)\s*\(/,f=/^\s*at (?:((?:\[object object\])?(?:[^(]*\([^)]*\))*[^()]*(?: \[as \S+\])?) )?\(?((?:file|http|https|chrome-extension):.*?)?:(\d+)(?::(\d+))?\)?\s*$/i,g=/^\s*(?:(\S*|global code)(?:\(.*?\))?@)?((?:file|http|https|chrome|safari-extension).*?):(\d+)(?::(\d+))?\s*$/i,m=/^\s*at .+ \(eval at \S+ \((?:(?:file|http|https):[^)]+)?\)(?:, [^:]*:\d+:\d+)?\)$/i,v=/^\s*at Function code \(Function code:\d+:\d+\)\s*/i;function p(e){var r=null;try{if(r=function(e){if(!e.stack)return null;var r=e.stack.split("\n").reduce(k,{frames:[],stackLines:[],wrapperSeen:!1});return r.frames.length?{mode:"stack",name:e.name||b(e),message:e.message,stackString:o(r.stackLines),frames:r.frames}:null}(e),r)return r}catch(t){d}try{if(r=function(e){if(!("line"in e))return null;var r=e.name||b(e);if(!e.sourceURL)return{mode:"sourceline",name:r,message:e.message,stackString:r+": "+e.message+"\n    in evaluated code",frames:[{func:"evaluated code"}]};var t=h(e.sourceURL),n=r+": "+e.message+"\n    at "+t;e.line&&(n+=":"+e.line,e.column&&(n+=":"+e.column));return{mode:"sourceline",name:r,message:e.message,stackString:n,frames:[{url:t,line:e.line,column:e.column}]}}(e),r)return r}catch(t){d}try{if(r=function(e){var r=e.name||b(e);return r?{mode:"nameonly",name:r,message:e.message,stackString:r+": "+e.message,frames:[]}:null}(e),r)return r}catch(t){d}return{mode:"failed",stackString:"",frames:[]}}function k(e,r){let t=function(e){var r=e.match(g);r||(r=e.match(f));if(r)return{url:r[2],func:"Anonymous function"!==r[1]&&"global code"!==r[1]&&r[1]||null,line:+r[3],column:r[4]?+r[4]:null};if(e.match(m)||e.match(v)||"anonymous"===e)return{func:"evaluated code"}}(r);if(!t)return e.stackLines.push(r),e;var n;if((n=t.func)&&n.indexOf("nrWrapper")>=0&&(e.wrapperSeen=!0),!e.wrapperSeen){let n=h(t.url);n!==t.url&&(r=r.replace(t.url,n),t.url=n),e.stackLines.push(r),e.frames.push(t)}return e}function b(e){var r=l.exec(String(e.constructor));return r&&r.length>1?r[1]:"unknown"}function _(e){var r=0;if(!e||!e.length)return r;for(var t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}var S=t(4613),y=t(7661),I=t(8038),C=t(5894),P=t(3973),D=t(8958),w=t(6276),A=t(7685),N=t(9025),j=t(1527);class R extends j.m{constructor(e,r){var t;super(e,r,A.t),t=this,this.stackReported={},this.observedAt={},this.pageviewReported={},this.errorCache={},this.currentBody=void 0,this.errorOnPage=!1,this.ee.on("interactionSaved",(e=>this.onInteractionSaved(e))),this.ee.on("interactionDiscarded",(e=>this.onInteractionDiscarded(e))),(0,S.X)("err",(function(){return t.storeError(...arguments)}),this.featureName,this.ee),(0,S.X)("ierr",(function(){return t.storeError(...arguments)}),this.featureName,this.ee);const n=(0,D.Mt)(this.agentIdentifier,"jserrors.harvestTimeSeconds")||10,s=new y.o("jserrors",{onFinished:function(){return t.onHarvestFinished(...arguments)}},this);s.harvest.on("jserrors",(function(){return t.onHarvestStarted(...arguments)})),this.ee.on("drain-".concat(this.featureName),(()=>{this.blocked||s.startTimer(n)})),(0,S.X)("block-err",(()=>{this.blocked=!0,s.stopTimer(!0)}),this.featureName,this.ee),this.drain()}onHarvestStarted(e){var r=this.aggregator.take(["err","ierr","xhr"]);e.retry&&(this.currentBody=r);var t={body:r,qs:{}},n=(0,I.P)((0,D.OP)(this.agentIdentifier).releaseIds);return"{}"!==n&&(t.qs.ri=n),r&&r.err&&r.err.length&&!this.errorOnPage&&(t.qs.pve="1",this.errorOnPage=!0),t}onHarvestFinished(e){e.retry&&this.currentBody&&((0,P.D)(this.currentBody,((e,r)=>{for(var t=0;t<r.length;t++){var n=r[t],s=this.getBucketName(e,n.params,n.custom);this.aggregator.merge(e,s,n.metrics,n.params,n.custom)}})),this.currentBody=null)}nameHash(e){return _("".concat(e.exceptionClass,"_").concat(e.message,"_").concat(e.stack_trace||e.browser_stack_hash))}getBucketName(e,r,t){return"xhr"===e?_((0,I.P)(r))+":"+_((0,I.P)(t)):this.nameHash(r)+":"+_((0,I.P)(t))}buildCanonicalStackString(e){for(var r="",t=0;t<e.frames.length;t++){var n=e.frames[t],s=a(n.func);r&&(r+="\n"),s&&(r+=s+"@"),"string"===typeof n.url&&(r+=n.url),n.line&&(r+=":"+n.line)}return r}storeError(e,r,t,n){var s,a;r=r||(0,w.z)();const i=(0,D.OP)(this.agentIdentifier);let o;if(!t&&i.onerror&&(o=i.onerror(e),o&&("string"!==typeof o.group||!o.group.length)))return;var u=p(e);const h={stackHash:_(this.buildCanonicalStackString(u)),exceptionClass:u.name,request_uri:null===c._A||void 0===c._A?void 0:c._A.location.pathname};u.message&&(h.message=""+u.message),null!==(s=o)&&void 0!==s&&s.group&&(h.errorGroup=o.group);var d,l=_("".concat(u.name,"_").concat(u.message,"_").concat(u.stackString));this.stackReported[l]?h.browser_stack_hash=_(u.stackString):(this.stackReported[l]=!0,h.stack_trace=(d=u.stackString).length>65530?d.substr(0,65530):d,this.observedAt[l]=i.offset+r),h.releaseIds=(0,I.P)(i.releaseIds),this.pageviewReported[l]||(h.pageview=1,this.pageviewReported[l]=!0),null!==i&&void 0!==i&&null!==(a=i.session)&&void 0!==a&&null!==(a=a.state)&&void 0!==a&&a.sessionReplayMode&&(h.hasReplay=!0),h.firstOccurrenceTimestamp=this.observedAt[l];var f=t?"ierr":"err",g={time:r};const m=[f,l,h,g];if((0,C.p)("errorAgg",m,void 0,N.D.sessionTrace,this.ee),(0,C.p)("errorAgg",m,void 0,N.D.spa,this.ee),(0,C.p)("errorAgg",m,void 0,N.D.sessionReplay,this.ee),!this.blocked){var v=(0,D.C5)(this.agentIdentifier).jsAttributes;if(null!=h._interactionId)this.errorCache[h._interactionId]=this.errorCache[h._interactionId]||[],this.errorCache[h._interactionId].push([f,l,h,g,v,n]);else{var k={};(0,P.D)(v,S),n&&(0,P.D)(n,S);var b=l+":"+_((0,I.P)(k));this.aggregator.store(f,b,h,g,k)}}function S(e,r){k[e]=r&&"object"===typeof r?(0,I.P)(r):r}}onInteractionSaved(e){this.errorCache[e.id]&&!this.blocked&&(this.errorCache[e.id].forEach((r=>{var t={},n=r[4],s=r[5];(0,P.D)(n,o),(0,P.D)(e.root.attrs.custom,o),(0,P.D)(s,o);var a=r[2];a.browserInteractionId=e.root.attrs.id,delete a._interactionId,a._interactionNodeId&&(a.parentNodeId=a._interactionNodeId.toString(),delete a._interactionNodeId);var i=r[1]+e.root.attrs.id+":"+_((0,I.P)(t));function o(e,r){t[e]=r&&"object"===typeof r?(0,I.P)(r):r}this.aggregator.store(r[0],i,a,r[3],t)})),delete this.errorCache[e.id])}onInteractionDiscarded(e){this.errorCache&&this.errorCache[e.id]&&!this.blocked&&(this.errorCache[e.id].forEach((r=>{var t={},n=r[4],s=r[5];(0,P.D)(n,o),(0,P.D)(e.root.attrs.custom,o),(0,P.D)(s,o);var a=r[2];delete a._interactionId,delete a._interactionNodeId;var i=r[1]+":"+_((0,I.P)(t));function o(e,r){t[e]=r&&"object"===typeof r?(0,I.P)(r):r}this.aggregator.store(r[0],i,r[2],r[3],t)})),delete this.errorCache[e.id])}}(0,n.Z)(R,"featureName",A.t)}}]);
//# sourceMappingURL=jserrors-aggregate.658a617f.chunk.js.map